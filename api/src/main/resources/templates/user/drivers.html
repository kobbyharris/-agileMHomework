<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drivers Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script th:src="@{/js/main.js}"></script>
    <style>
        /* Modal Background */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        /* Modal Content */
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            height: auto;
            max-height: 80vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        /* Flex Layout for Modal Details */
        .modal-content .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .modal-content .grid p {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* For larger screens, we adjust the grid layout */
        @media (min-width: 768px) {
            .modal-content .grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Modal Close Button */
        .modal .text-2xl {
            position: absolute;
            top: 1rem;
            right: 1rem;
        }

        /* Hide the scrollbar track */
        ::-webkit-scrollbar {
            width: 10px;
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 50px;
            height: 20%;
            background-clip: padding-box;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* For Firefox: make scrollbar thin and short */
        * {
            scrollbar-width: thin;
            scrollbar-color: #888 transparent;
        }

        /* Optional: Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>

<body class="bg-gray-50 font-sans leading-normal tracking-normal">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div th:insert="~{user/fragments/sidebar :: sidebar}"></div>
        <!-- Sidebar End -->

        <!-- Main Content -->
        <div class="flex-1 bg-white overflow-y-auto">
            <!-- Header -->
            <div th:insert="~{user/fragments/header :: header}"></div>
            <!-- Header End -->

            <!-- Navigation Section -->
            <div th:insert="~{user/fragments/header :: navigation}"></div>

            <div class="p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Driver List</h2>
                <div class="mb-6">
                    <input type="text" id="driverSearch" placeholder="Search for drivers..." class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-blue-200" oninput="filterDrivers()">
                </div>

                <!-- Driver Grid -->
                <div id="driverList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Driver Cards will be populated here dynamically -->
                </div>
            </div>

            <!-- Driver Details Popup -->
            <div id="driverModal" class="modal hidden flex">
                <div class="modal-content">
                    <div class="flex justify-between items-center pb-4">
                        <h2 class="text-xl font-bold">Driver Details</h2>
                        <button class="text-gray-500 hover:text-gray-700 text-2xl" onclick="closeDriverDetails()"></button>
                    </div>
                    <div class="space-y-4">
                        <img id="driverImage" src="" alt="Driver Image" class="mb-4 w-24 h-24 rounded-full object-cover">
                        <div class="grid grid-cols-2 gap-4">
                            <p><strong>Name:</strong> <span id="driverName">-</span></p>
                            <p><strong>Telephone:</strong> <span id="telephone">-</span></p>
                            <p hidden><strong></strong> <span id="vehicle">-</span></p>
                            <p hidden><strong></strong> <span id="licenseNumber">-</span></p>
                            <p hidden><strong></strong> <span id="driverStatus">-</span></p>
                        </div>
                        <div class="flex gap-4">
                            <a id="editLink" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg">Edit</a>
                            <a id="deleteLink" class="mt-4 px-4 py-2 bg-red-600 text-white hover:bg-red-700 focus:ring-2 focus:ring-red-500 rounded-lg shadow-sm border">Delete</a>
                            <a id="viewVehicleLink" class="mt-4 px-4 py-2 text-gray-500 rounded-lg shadow-sm border">Vehicle Detail</a>
                        </div>
                    </div>
                </div>
            </div>

            <script th:src="@{/js/drivers.js}"></script>
            <script>
                // Fetch driver data from backend
                async function fetchDriverData() {
                    try {
                        const response = await fetch('http://localhost:8080/t/drivers/json'); // Adjust URL as needed
                        const drivers = await response.json();
                        console.log(drivers); // Log the data to ensure it's coming through
                        populateDriverGrid(drivers);
                    } catch (error) {
                        console.error("Error fetching drivers:", error);
                    }
                }

                // Populate the driver grid with data from the backend
                function populateDriverGrid(drivers) {
                    const driverList = document.getElementById('driverList');
                    driverList.innerHTML = ''; // Clear existing content

                    drivers.forEach(driver => {
                        const card = document.createElement('div');
                        card.classList.add('driver-card');
                        card.setAttribute('data-name', driver.firstName + ' ' + driver.lastName);

                        card.innerHTML = `
                            <div class="bg-gray-50 p-4 rounded-lg shadow-sm border relative group cursor-pointer" 
                                onclick="showDriverDetails('${driver.driverId}', '${driver.firstName}', '${driver.lastName}', '${driver.contact}', '${driver.assigned_vehicle}', '${driver.portraitUrl}')">
                                <img src="${driver.portraitUrl}" alt="Driver Image" class="mb-2 rounded-full w-24 h-24 object-cover">
                                <p class="font-semibold">${driver.firstName} ${driver.lastName}</p>
                                <p class="text-sm text-gray-500">Contact: ${driver.contact}</p>
                            </div>
                        `;

                        driverList.appendChild(card);
                    });
                }

                // Show driver details in the modal
                function showDriverDetails(driverId, firstName, lastName, contact, assigned_vehicle, portraitUrl) {
                    document.getElementById('driverName').textContent = firstName + ' ' + lastName;
                    document.getElementById('telephone').textContent = contact;
                    document.getElementById('vehicle').textContent = assigned_vehicle;
                    document.getElementById('licenseNumber').textContent = 'N/A'; // Placeholder or change as needed
                    document.getElementById('driverStatus').textContent = 'Active'; // Change status logic as needed
                    document.getElementById('driverImage').src = portraitUrl;

                    document.getElementById('editLink').href = `/t/driver-edit-unit/${driverId}`;
                    document.getElementById('deleteLink').href = `/t/driver-delete-unit/${driverId}`;
                    document.getElementById('viewVehicleLink').href = `/t/vehicles/${assigned_vehicle}`;

                    document.getElementById('driverModal').classList.remove('hidden');
                }

                // Close the driver details modal
                function closeDriverDetails() {
                    document.getElementById('driverModal').classList.add('hidden');
                }

                // Filter the drivers based on the search input
                function filterDrivers() {
                    const searchTerm = document.getElementById('driverSearch').value.toLowerCase();
                    const driverCards = document.querySelectorAll('.driver-card');

                    driverCards.forEach(card => {
                        const driverName = card.getAttribute('data-name').toLowerCase();

                        if (driverName.includes(searchTerm)) {
                            card.style.display = '';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                }

                // Fetch data when the page loads
                window.onload = fetchDriverData;
            </script>

        </div>
    </div>
</body>

</html>
